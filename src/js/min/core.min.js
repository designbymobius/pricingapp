!function(){function a(){var a=z();q(),j(),i(),h(),B(),A(),C(),F(),"up"===a?Y("network-up",null,this):Y("network-down",null,this),g(),m(cb),document.addEventListener("touchmove",function(a){for(var b=a.target;b!==document.body;)b=b.parentNode;a.preventDefault()})}function b(a){function b(){window.removeEventListener("keydown",c),d.removeEventListener("click",n)}function c(a){13===a.keyCode&&n()}var d=a.getElementsByClassName("btn")[0];$("teardown-screen","landing",b),window.addEventListener("keydown",c),d.addEventListener("click",n)}function c(){function a(){b.removeEventListener("click",O),c.removeEventListener("click",P)}var b=document.getElementById("start-add-product"),c=document.getElementById("start-view-products");$("teardown-screen","tasks",a),c.addEventListener("click",P),b.addEventListener("click",O)}function d(a){function b(){for(var a=0,b=e.length,c=b-1;c>=0;c--)e[c].value||(a+=1,K(e[c],"attention"),e[c].addEventListener("keydown",d));1>a&&(R=f.value,S=g.value,n())}function c(){for(var a=e.length,c=a-1;c>=0;c--)e[c].value="",J(e[c],"attention")&&L(e[c],"attention");h.removeEventListener("click",b)}function d(a){a.target.value&&(L(a.target,"attention"),a.target.removeEventListener("keydown",d))}var e=a.getElementsByTagName("input"),f=a.getElementsByClassName("product-name")[0],g=a.getElementsByClassName("manufacturer-name")[0],h=a.getElementsByClassName("btn")[0];h.addEventListener("click",b),$("teardown-screen","add-product-metadata",c),$("task-ended","reset-new-product-values",function(){R=null,S=null,T=null})}function e(a){function b(){var a,b={};b.name=encodeURIComponent(R),b.manufacturer=encodeURIComponent(S),M("add-product.php","product="+JSON.stringify(b)),a=confirm("Done! Add Another Product?"),a===!0&&(_("task-ended","task-teardown"),$("task-ended","restart-task",function(){p("add-product"),O()})),Y("task-ended",null,"add-product-btn")}for(var c=a.getElementsByClassName("manufacturer-name"),d=a.getElementsByClassName("product-name"),e=document.getElementById("submit-add-product"),f=c.length-1;f>=0;f--)c[f].innerHTML=S;for(f=d.length-1;f>=0;f--)d[f].innerHTML=R;e.addEventListener("click",b),$("teardown-screen","add-product-confirmation",function(){e.removeEventListener("click",b);for(var a=c.length-1;a>=0;a--)c[a].innerHTML="";for(a=d.length-1;a>=0;a--)d[a].innerHTML=""})}function f(a){function b(){k.removeEventListener("click",h),k.removeEventListener("touchmove",c),_("screens-resized","resize-list-wrapper"),_("product-list-rendered","filter-by-manufacturer"),_("product-metadata-updated","update-product-list"),$("setup-complete","cleanup-product-list",function(){setTimeout(function(){if(k.innerHTML="",l.selectedIndex=0,"createEvent"in document){var a=document.createEvent("HTMLEvents");a.initEvent("change",!1,!0),l.dispatchEvent(a)}else l.fireEvent("onchange");l.removeEventListener("change",i)},150)})}function c(b){for(var c=b.target;c!=k;){if(c.parentNode==a||c.parentNode==document.body)return;c=c.parentNode}b.stopPropagation()}function d(){e()}function e(){k.style.height=.7*a.offsetHeight+"px"}function f(){function a(){b=JSON.parse(manufacturer_db_json);for(var a in b)c+="<option value='"+b[a].Id+"'>"+b[a].Name+"</option>";l.innerHTML=c}var b,c="<option value='-1'>ALL</option>";"undefined"==typeof manufacturer_db_json?U.get("manufacturer",function(b,c){b?(manufacturer_db_json=c,a()):($("manufacturer-metadata-updated","render-product-list",function(b){manufacturer_db_json=b.notificationParams,a()}),u())}):a()}function g(){function a(){var a,b,g,h;if(a=JSON.parse(c),h=a.length,!a||a.length<1)f="there are no products in the database ...",k.innerHTML=f;else{b=N(e,"Id"),g=JSON.parse(d),g.product||(g.product={}),a.sort(function(a,b){return a=a.Name.toLowerCase(),b=b.Name.toLowerCase(),a>b?1:b>a?-1:0});for(var i=a.length;i>=1;i--){var j,l,m,n=a[h-i],o=n.Id,p=n.ManufacturerId;j=g.product&&g.product[o]?!0:!1,l=j&&g.product[o].price?!0:!1,m=l?"&#8358;"+g.product[o].price:n.Price?"&#8358;"+n.Price:"-----",f+="<div class='product"+(j?" editted-product":"")+"' data-product-name='"+n.Name+"' data-product-id='"+o+"'data-manufacturer-id='"+p+"'> <div class='name'>"+b[p].Name+" "+n.Name+"</div> <div class='price"+(l?" modified-value":"")+"'>"+m+"</div><div class='settings'>edit</div></div>"}k.innerHTML=f}Y("product-list-rendered",null,"render-product-list")}function b(){var a=!1;return"undefined"!=typeof c&&"undefined"!=typeof d&&"undefined"!=typeof e&&(a=!0),a}var c,d,e,f="";U.get("product",function(d,e){d&&null!==e?(c=e,b()&&a()):$("product-metadata-updated","render-product-list",function(d){c=d.notificationParams,b()&&a()}),t()}),U.get("manufacturer",function(c,d){c&&null!==d?(e=d,b()&&a()):$("manufacturer-metadata-updated","render-product-list",function(c){e=c.notificationParams,b()&&a()}),u()}),U.get("transaction",function(c,e){c&&null!==e?(d=e,b()&&a()):$("transaction-metadata-updated","render-product-list",function(c){d=c.notificationParams,b()&&a()})})}function h(a){for(var b,c,d,e=a.target;!J(e,"settings");){if(e.parentNode==k||e.parentNode==document.body)return;e=e.parentNode}if(b=e.parentNode,K(b,"edit-product"),c=b.getAttribute("data-product-id"),d=prompt("Set Price for '"+b.getAttribute("data-product-name").toUpperCase()+"'?"),null!==d){var f=b.getElementsByClassName("price")[0];j(c,d),f.innerHTML="&#8358;"+d,K(f,"modified-value"),K(b,"editted-product")}L(b,"edit-product")}function i(a){var b=a.target,c=b.options[b.selectedIndex],d=c.value,e=k.getElementsByClassName("product");-1==d?L(k,"filtered"):K(k,"filtered");for(var f in e){var g=e[f];"undefined"!=typeof g.parentNode&&(g.getAttribute("data-manufacturer-id")==d?K(g,"manufacturer-filter-match"):L(g,"manufacturer-filter-match"))}}function j(a,b){U.get("transaction",function(c,d){var e="{}";d&&(e=d),transaction_db=JSON.parse(e),transaction_db.product||(transaction_db.product={}),transaction_db.product[a]||(transaction_db.product[a]={}),transaction_db.product[a].price=encodeURIComponent(b),U.set("transaction",JSON.stringify(transaction_db))})}var k=document.getElementById("product-list"),l=document.getElementById("manufacturer-list");$("teardown-screen","teardown",b),Z("product-metadata-updated","update-product-list",function(a){var b=a.notificationParams;alert("Loading Updates"),g(b)}),Z("manufacturer-metadata-updated","update-manufacturer-list",function(a){var b=a.notificationParams;console.log("updated manufacturer db"),console.log(JSON.parse(b))}),Z("product-list-rendered","filter-by-manufacturer",function(){if("createEvent"in document){var a=document.createEvent("HTMLEvents");a.initEvent("change",!1,!0),l.dispatchEvent(a)}else l.fireEvent("onchange")}),d(),Z("screens-resized","resize-list-wrappers",d),k.addEventListener("click",h),k.addEventListener("touchmove",c),l.addEventListener("change",i),g(),f()}function g(){Z("setup-screen","do_screen_setup",l)}function h(){I(function(){Y("window-resized",null,this)})}function i(){Z("window-resized","screen-height-updater",j),Z("screens-resized","autoscroller",k)}function j(){for(var a,b,c=db.length-1;c>=0&&!(cb>c);c--)a=document.defaultView.getComputedStyle(db[c],null).getPropertyValue("padding-top").replace("px",""),b=document.defaultView.getComputedStyle(db[c],null).getPropertyValue("padding-bottom").replace("px",""),db[c].style.height=window.innerHeight-a-b+"px";Y("screens-resized",null,this)}function k(){eb(db[cb].offsetTop,150)}function l(){var a=db[cb],b=a.id.replace(/\-/g,"_");$("setup-complete","scroll-screen-into-view",function(){eb(a.offsetTop,400)}),K(a,"focal"),$("teardown-screen","defocalizer",function(){L(a,"focal")}),bb[b](a),Y("setup-complete",null,"do_screen_setup")}function m(a){Y("teardown-screen",null,this),cb=a,Y("setup-screen",null,this)}function n(){m(cb+1)}function o(a){for(var b=0,c=0;c<ab.length;c++)J(ab[c],a)&&(K(ab[c],"active"),db.push(ab[c]),b+=1);b>0&&j()}function p(a){for(var b=0,c=db.length-1;c>=0;c--)J(db[c],a)&&(L(db[c],"active"),db.splice(c,1),b+=1),b>0&&(j(),cb=db.length-1)}function q(){for(var a=0;a<ab.length;a++)L(ab[a],"active");db=[],o("landing"),o("tasks")}function r(){var a=function(){clearInterval(V.heartbeat),delete V.heartbeat};V.heartbeat=setInterval(W.check,7500),$("network-down","heartbeat",a,null)}function s(){var a=function(){clearInterval(V.transaction),delete V.transaction};V.transaction=setInterval(function(){U.get("transaction",function(a,b){var c=JSON.parse(b),d=!1;if(c){for(var e in c)if(c.hasOwnProperty(e)){d=!0;break}d&&(M("process-transaction.php","transaction="+b,function(a){var b=JSON.parse(a);t(),console.log("-- TRANSACTION REPORT --"),b.product&&U.get("product",function(a,c){var d=JSON.parse(c);for(var e in b.product){for(var f,g=d.length-1;g>=0;g--)if(d[d.length-1-g].Id==e){f=d[d.length-1-g].Name;break}for(var h in b.product[e])console.log(f.toUpperCase()+" "+h.toUpperCase()+" UPDATED TO '"+b.product[e][h]+"'")}})}),U.set("transaction","{}"))}})},3e4),$("network-down","transaction",a,null)}function t(){v("product","get-product.php")}function u(){v("manufacturer","get-manufacturer.php")}function v(a,b){return a&&b?void U.get(a,function(c,d){M(b,null,function(b){d!=b&&(U.set(a,b),Y(a+"-metadata-updated",b,"download-current-"+a+"-db"))})}):!1}function w(){var a=document.getElementsByClassName("connection-indicator");V.checkingLightFlickerInterval=setInterval(function(){for(var b=a.length-1;b>=0;b--)K(a[b],"connection-checking"),setTimeout(function(){var c=b;return function(){L(a[c],"connection-checking")}}(),350)},2e3),$("network-reconnecting-exit","light-flicker",function(){clearInterval(V.checkingLightFlickerInterval)},null)}function x(){L(document.body,"connection-offline"),K(document.body,"connection-online")}function y(){L(document.body,"connection-online"),K(document.body,"connection-offline")}function z(){return W.check(),W.state}function A(){W.on("up",function(){Y("network-up",null,"connection-watchdog")}),W.on("down",function(){Y("network-down",null,"connection-watchdog")}),W.on("reconnect:started",function(){Y("network-reconnecting",null,"connection-watchdog")}),W.on("reconnect:stopped",function(){Y("network-reconnecting-exit",null,"connection-watchdog")})}function B(){Z("network-up","online-indicator",x),Z("network-up","heartbeat",r),Z("network-up","transaction",s),Z("network-down","online-indicator",y),Z("network-reconnecting","light-flicker",w)}function C(){window.applicationCache&&(window.applicationCache.addEventListener("downloading",E),window.applicationCache.addEventListener("updateready",D))}function D(){alert("App Has Been Updated and will Restart Now"),window.applicationCache.swapCache(),location.reload(!0)}function E(){alert("Downloading App Updates - Sorry for the Wait")}function F(){G()}function G(){U=new Persist.Store("Pricing App Storage",{about:"Data Storage to enhance Offline usage",path:location.href})}function H(a,b,c,d){Z(a,b,function(){c(d),_(a,b)},d)}function I(a,b){return onresize=function(){clearTimeout(b),b=setTimeout(a,250)},a}function J(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))}function K(a,b){J(a,b)||(a.className+=" "+b)}function L(a,b){if(J(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}}function M(a,b,c,d){if(!a)return!1;var e=new XMLHttpRequest;return b=b||"",c=c||function(b){console.log("POST TO "+a+" SUCCESSFUL! \nRESPONSE: "),console.log(b)},d=d||function(b){console.log("POST TO "+a+" UNSUCCESSFUL. \nXMLHTTP OBJECT:"),console.log(b)},e.open("POST",a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){4==e.readyState&&(e.status>199&&e.status<400?c(e.responseText):d(e))},e.send(b),!0}function N(a,b){var c,d={};c=JSON.parse(a);for(var e in c)d[c[e][b]]=c[e];return d}function O(){o("add-product"),n(),Q(),$("task-ended","task-teardown",function(){m(1),setTimeout(function(){p("add-product")},250)})}function P(){o("view-product"),n(),Q(),$("task-ended","task-teardown",function(){m(1),setTimeout(function(){p("view-product")},250)})}function Q(){var a=document.getElementById("context-settings"),b="<div id='cancel-task' class='setting'>cancel task</div>";a.innerHTML+=b,$("task-ended","remove-cancel-task-btn",function(){var a=document.getElementById("cancel-task");a.parentNode.removeChild(a)}),document.getElementById("cancel-task").addEventListener("click",function(){Y("task-ended","cancel-task-btn")})}var R,S,T,U,V={},W=Offline,X=dxmPubSub,Y=X.publish,Z=X.subscribe,$=H,_=X.unsubscribe,ab=document.getElementsByClassName("fullscreen"),bb={},cb=0,db=[];bb.landing=b,bb.tasks=c,bb.add_product_metadata=d,bb.add_product_confirmation=e,bb.view_product_list=f,W.options={checkOnLoad:!0,interceptRequests:!1,requests:!1,checks:{active:"xhr",xhr:{url:"server-check.php"}}};var eb=function(){var a,b,c;return function(d,e,f){function g(){var d;c=(Date.now()-b)/e,c>=1&&(clearInterval(a),c=1,f()),d=c*i+h,window.scrollBy(0,d-window.pageYOffset)}var h=window.pageYOffset,i=d-window.pageYOffset;return e=e||400,f=f||function(){Y("arrived-at-new-screen",null,"scroll-screen-into-view")},b=Date.now(),c=0,a&&clearInterval(a),a=setInterval(g,10)}}();X.log.crawl=function(a){for(var b="",c=0;c<X.log.length-1;c+=1)(("string"==typeof a||a instanceof String)&&(("string"==typeof X.log[c].publisher||X.log[c].publisher instanceof String)&&X.log[c].publisher.toLowerCase()==a.toLowerCase()||("string"==typeof X.log[c].subscriber||X.log[c].subscriber instanceof String)&&X.log[c].subscriber.toLowerCase()==a.toLowerCase()||("string"==typeof X.log[c].unsubscriber||X.log[c].unsubscriber instanceof String)&&X.log[c].unsubscriber.toLowerCase()==a.toLowerCase()||("string"==typeof X.log[c].type||X.log[c].type instanceof String)&&X.log[c].type.toLowerCase()==a.toLowerCase()||("string"==typeof X.log[c].notification||X.log[c].notification instanceof String)&&X.log[c].notification.toLowerCase()==a.toLowerCase())||null===a&&X.log[c].publisher)&&(b+="\n\n-["+c+"]-\n["+(X.log[c].subscriber||X.log[c].publisher||X.log[c].unsubscriber)+"] "+X.log[c].type+" "+X.log[c].notification);console.log(b)},X.log.range=function(a,b){var c,d,e="";if(c=a>b?b:a,d=a>b?a:b,0>c||d>X.log.length-1)return console.log("wtf bro");console.log("crawling "+c+" to "+d);for(var f=c;d>=f;f+=1)e+="\n\n-["+f+"]-\n["+(X.log[f].subscriber||X.log[f].publisher||X.log[f].unsubscriber)+"] "+X.log[f].type+" "+X.log[f].notification;console.log(e)},document.addEventListener("DOMContentLoaded",function(){a(),goto=m,ASE=db,currentIntervals=V,peepDB=function(a){U.get(a,function(b,c){return b?void console.log(JSON.parse(c)):void console.log("couldn't retrieve "+a+" db")})}})}();